package rsitradingview

import org.scalatest.funsuite.AnyFunSuite


class RSITradingViewSpec extends AnyFunSuite {
  private val closings = Vector(1.20352, 1.20341, 1.20344, 1.20356, 1.20358, 1.20364, 1.20346, 1.20347, 1.20352, 1.20349, 1.20349, 1.20352,
    1.20354, 1.20346, 1.20345, 1.20338, 1.20346, 1.20346, 1.20362, 1.20356, 1.20326, 1.20327, 1.20332, 1.20333, 1.20341, 1.20335, 1.20316,
    1.2032, 1.20316, 1.20318, 1.20316, 1.20327, 1.20317, 1.20326, 1.20346, 1.2035, 1.20336, 1.20325, 1.20338, 1.20352, 1.20347, 1.20391,
    1.20367, 1.20376, 1.204, 1.20417, 1.20411, 1.20415, 1.20374, 1.20347, 1.2036, 1.20373, 1.20345, 1.2032, 1.20359, 1.20337, 1.20378,
    1.20415, 1.20411, 1.20406, 1.20391, 1.2037, 1.20356, 1.2036, 1.20366, 1.20362, 1.20334, 1.20323, 1.20342, 1.20314, 1.20296, 1.20302,
    1.20316, 1.20324, 1.20329, 1.2032, 1.20314, 1.20312, 1.20314, 1.20321, 1.20328, 1.20311, 1.20314, 1.203, 1.2031, 1.20306, 1.20301,
    1.20288, 1.20282, 1.20282, 1.20278, 1.20272, 1.2027, 1.2026, 1.20252, 1.20262, 1.20276, 1.20276, 1.20281, 1.2028, 1.2027, 1.20284,
    1.20294, 1.20301, 1.20306, 1.20322, 1.20321, 1.20326, 1.2033, 1.20309, 1.20286, 1.20336, 1.20346, 1.20316, 1.2029, 1.20263, 1.20266,
    1.20302, 1.2031, 1.20286, 1.2031, 1.20288, 1.202, 1.20242, 1.20244, 1.2022, 1.2019, 1.20154, 1.20164, 1.20061, 1.20073, 1.2006, 1.20084,
    1.20112, 1.20096, 1.20096, 1.20108, 1.20148, 1.2012, 1.20118, 1.20128, 1.20118, 1.20116, 1.20116, 1.20122, 1.20062, 1.20108, 1.20127,
    1.20152, 1.20122, 1.20135, 1.2013, 1.20054, 1.20022, 1.20034, 1.20053, 1.20076, 1.20072, 1.20038, 1.2007, 1.20084, 1.20086, 1.20023,
    1.19992, 1.2003, 1.20048, 1.20055, 1.20073, 1.20094, 1.20098, 1.20072, 1.20074, 1.20096, 1.20073, 1.20062, 1.20054, 1.20042, 1.20062,
    1.20058, 1.20051, 1.201, 1.20068, 1.2006, 1.20056, 1.20074, 1.20068, 1.20104, 1.20088, 1.2008, 1.20054, 1.20115, 1.20096, 1.2009,
    1.20141, 1.20109, 1.2008, 1.2002, 1.20056, 1.2006, 1.20032, 1.20018, 1.20017, 1.20065, 1.20086, 1.20066, 1.20116, 1.20084, 1.20082,
    1.2006, 1.20066, 1.20137, 1.20187, 1.20134, 1.20196, 1.20186, 1.20254, 1.20285, 1.20282, 1.20294, 1.2031, 1.20357, 1.2033, 1.20339,
    1.20332, 1.20352, 1.20373, 1.2038, 1.2036, 1.2034, 1.20333, 1.2031, 1.20344, 1.20292, 1.20294, 1.20288, 1.20292, 1.20316, 1.20309,
    1.20316, 1.20321, 1.20318, 1.20275, 1.20278, 1.20316, 1.2032, 1.20306, 1.20319, 1.20296, 1.20302, 1.20298, 1.20294, 1.203, 1.20308,
    1.20284, 1.20272, 1.20288, 1.20299, 1.20298, 1.20295, 1.20274, 1.20284, 1.20282, 1.20285, 1.2028, 1.20294, 1.20291, 1.20294, 1.203,
    1.20325, 1.20317, 1.20328, 1.20334, 1.20347, 1.20345, 1.20338, 1.20334, 1.20337, 1.20344, 1.20347, 1.2034, 1.20344, 1.20344, 1.20334,
    1.20334, 1.20352, 1.20353, 1.2035, 1.20348, 1.20348, 1.20349, 1.2033, 1.20344, 1.20335, 1.20338, 1.20336, 1.20339, 1.20356, 1.20358,
    1.2036, 1.20363, 1.20354, 1.20348, 1.20352, 1.20346, 1.20345, 1.20342, 1.20344, 1.20344, 1.20338, 1.2034, 1.20334, 1.20348, 1.2035,
    1.2036, 1.2036, 1.20372, 1.2037, 1.20374, 1.20375, 1.20374, 1.2037, 1.2037, 1.20379, 1.20373, 1.20384, 1.20372, 1.20366, 1.20356,
    1.20345, 1.20332, 1.20345, 1.20364, 1.20365, 1.20394, 1.20376, 1.20368, 1.20365, 1.204, 1.20384, 1.20376, 1.20401, 1.20394, 1.20405,
    1.20416, 1.20426, 1.20439, 1.2044, 1.2042, 1.20435, 1.20426, 1.20454, 1.20448, 1.20456, 1.20459, 1.20457, 1.20454, 1.20452, 1.20442,
    1.20444, 1.20468, 1.20448, 1.20454, 1.20443, 1.20444, 1.2045, 1.20444, 1.20408, 1.20385, 1.2039, 1.20394, 1.2038, 1.20364, 1.20364,
    1.20364, 1.20344, 1.20338, 1.2035, 1.20344, 1.20346, 1.2033, 1.20341, 1.20326, 1.20336, 1.20338, 1.20333, 1.20327, 1.20316, 1.2033,
    1.20314, 1.20325, 1.20329, 1.20344, 1.2035, 1.20354, 1.2037, 1.20339, 1.2032, 1.2035, 1.20307, 1.20311)

  test("Convergence") {
    val initialHistory = closings.dropRight(3)
    val Vector(closing1, closing2, closing3) = closings.takeRight(3)

    val rsiTradingView = RSITradingView.recreate(initialHistory)
    val rsiTradingView1 = rsiTradingView.update(closing1, initialHistory.last)
    val rsiTradingView2 = rsiTradingView1.update(closing2, closing1)
    val rsiTradingView3 = rsiTradingView2.update(closing3, closing2)

    assert(rsiTradingView.history.takeRight(3) == List(56.400784355352506, 45.43956056077414, 40.27339064224811))
    assert(rsiTradingView3.history.takeRight(3) == List(49.949398303058125, 39.95730619744669, 41.13693470919584))
  }
}
